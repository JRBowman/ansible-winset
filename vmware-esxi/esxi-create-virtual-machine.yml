---
#-------------------
# vmware_guest Module - Create Virtual Machine
# https://docs.ansible.com/ansible/latest/collections/community/vmware/vmware_guest_module.html
#-------------------

#-------------------
# Required Variables:
# - esxi_hostname
# - esxi_username
# - esxi_password
# - esxi_vm_name
# - esxi_vm_memory
# - esxi_vm_cpu

- name: Create a virtual machine on given ESXi hostname
  vmware_guest:
    hostname: "{{ esxi_hostname }}"
    username: "{{ esxi_username }}"
    password: "{{ esxi_password }}"
    validate_certs: no
    folder: /DC1/vm/
    name: "{{esxi_vm_name}}"
    state: poweredon
    guest_id: windows
    # This is hostname of particular ESXi server on which user wants VM to be deployed
    esxi_hostname: "{{ esxi_hostname }}"
    disk:
    - size_gb: 10
      type: thin
      datastore: datastore1
    hardware:
      memory_mb: "{{esxi_vm_memory}}"
      num_cpus: "{{esxi_vm_cpu}}"
      scsi: paravirtual
    networks:
    - name: VM Network
      device_type: vmxnet3
    wait_for_ip_address: yes
    wait_for_ip_address_timeout: 600
  delegate_to: localhost
  register: deploy_vm